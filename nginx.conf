worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include       /usr/local/openresty/nginx/conf/mime.types;
    default_type  application/json;

    # Логирование
    access_log logs/access.log;
    error_log logs/error.log;

    # Проксирование запросов к сервису 1
    upstream service1 {
        server localhost:5001;
    }

    # Проксирование запросов к сервису 2
    upstream service2 {
        server localhost:5002;
    }

    server {
        listen 8080;

        # Роутинг для сброса состояния
        location /reset {
            proxy_pass http://$http_host/reset;
            proxy_set_header Host $host;
        }

        # Роутинг для взаимодействия с сервисами
        location /service1/message {
            proxy_pass http://service1/message;
            proxy_set_header Host $host;
        }

        location /service2/message {
            proxy_pass http://service2/message;
            proxy_set_header Host $host;
        }
    }
}

